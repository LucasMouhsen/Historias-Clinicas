<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="shortcut icon" href="#">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>DataTables estilo Bootstrap 5 - NodeJS y Express</title>
    
  <!-- DataTable -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css" />
  
    <style>
        table.dataTable thead {
            background-color: #7952b3;
            color: aliceblue;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <button id="btnCrear" class="btn btn-dark mt-2">Crear</button>
        <div class="row shadow-lg p-3 mb-5">
            <div class="col">
                <table id="tablaArticulos" class="table table-striped table-bordered" style="width:100%">
                    <thead>
                        <tr>
                            <th>HC</th>
                            <th>ULTIMO REGISTRO</th>
                            <th>NOMBRE COMPLETO</th>
                            <th>I</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
      <!-- jQuery -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
      <!-- DataTable -->
      <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
      <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
    <script>
        const capitalizarPalabras = (str) => {
            const palabras = str.split(' ');
            const resultado = palabras.map((palabra) => {
                return palabra.charAt(0).toUpperCase() + palabra.slice(1);
            });
            return resultado.join(' ');
        };

        const formatearFecha = (fechaISO) => {
            // Crear un objeto Date con la fecha
            const fecha = new Date(fechaISO);

            // Obtener día, mes y año
            const dia = fecha.getUTCDate();
            const mes = fecha.getUTCMonth() + 1; // Sumar 1 porque los meses comienzan desde 0
            const ano = fecha.getUTCFullYear();

            // Formatear la fecha como 'dd/mm/yyyy'
            const fechaFormateada = (dia < 10 ? '0' : '') + dia + '/' + (mes < 10 ? '0' : '') + mes + '/' + ano;
            return fechaFormateada

        }
        $(document).ready(function () {
            let url = 'http://172.21.16.51:3001/historias';
            let hc, ultimoRegistro, persona;
            //MOSTRAR
            let tablaArticulos = $('#tablaArticulos').DataTable({
                'processing': true,
                'serverSide': true,
                'ajax': function (request, drawCallback, request) {
                    $.getJSON(url)
                },
                "columns": [
                    { 'data': 'hc' },
                    { 'data': 'ultimoRegistro', render: (data) => formatearFecha(data) },
                    { 'data': 'persona', render: (data) => capitalizarPalabras(data.nombre) + ' ' + capitalizarPalabras(data.apellido) },
                    { 'data': null, render: (data) => `<a href="/hc/${data.id}"><i class="fa-solid fa-circle-info"></i>a</a>` },
                ],
                pageLength: 10
            });
        });
    </script>
    
</body>

</html>